<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nanuri.rams.business.common.mapper.IBIMS902BMapper">

    <!-- 입금요청, 출금요청 -->
    <!-- SPC별 거래내역 조회 -->
    <select id="selectTB07230S" parameterType="com.nanuri.rams.business.common.vo.IBIMS902BVO" resultType="com.nanuri.rams.business.common.vo.IBIMS902BVO">
        SELECT T1.TR_DT                                  AS TR_DT            -- 거래일자
		      , ( SELECT ENTP_NM FROM IBIMS010B WHERE ARDY_BZEP_NO = T2.ARDY_BZEP_NO)                
		                                                  AS SPC_NM           -- SPC명
		      , T2.ISTT_CD                                AS ISTT_NM          -- **************은행명 변경예정
		      , T2.ASST_MNGM_ACNO                         AS ASST_MNGM_ACNO   -- 자산관리계좌번호
		      , DECODE(T1.RNDR_DCD, '1', '입금', '출금')  AS RNDR_NM          -- 입출금구분
		      , (SELECT CD_VL_NM FROM IBIMS002B WHERE CMNS_CD_GRP = DECODE(T1.RNDR_DCD, '1', '입금공통코드', '출금공통코드') AND CD_VL_ID = DECODE(T1.RNDR_DCD, '1', T1.SPC_DEP_ITEM_KND_CD, T1.SPC_WDR_ITEM_KND_CD))
		                                                  AS SPC_ITEM_KND_NM  -- 항목
		      , T1.SYNS_TEXT                              AS SYNS_TEXT        -- 적요
		      , T1.RNDR_AMT                               AS RNDR_AMT         -- 금액
		      , T1.RNDR_BLCE                              AS RNDR_BLCE        -- 잔고
		      , ( SELECT ENTP_NM FROM IBIMS010B WHERE ARDY_BZEP_NO = T1.TR_OTHR_DSCM_NO)
		                                                  AS RCVE_P           -- 수령자
		      , T2.DPRT_CD                                AS DPRT_NM          -- **************관리부점 변경예정
		      , T2.RM_CTNS                                AS RM_CTNS          -- 비고
		   FROM IBIMS902B T1
		      , IBIMS900B T2
		  WHERE 1=1
		    AND T2.ARDY_BZEP_NO     = T1.ARDY_BZEP_NO
		    AND T2.FINC_EXCU_RQS_SN = T1.FINC_EXCU_RQS_SN
		   <if test="@com.nanuri.rams.com.utils.MybatisCheck@notEmpty(fromDate) and @com.nanuri.rams.com.utils.MybatisCheck@notEmpty(toDate)">
            AND T1.TR_DT            BETWEEN #{fromDate} AND #{toDate}
           </if>
           <if test="@com.nanuri.rams.com.utils.MybatisCheck@notEmpty(fromDate) and @com.nanuri.rams.com.utils.MybatisCheck@empty(toDate)">
            AND T1.TR_DT            <![CDATA[>=]]> #{fromDate}
           </if>
           <if test="@com.nanuri.rams.com.utils.MybatisCheck@empty(fromDate) and @com.nanuri.rams.com.utils.MybatisCheck@notEmpty(toDate)">
            AND T1.TR_DT            <![CDATA[<=]]> #{toDate}
           </if>
           <if test="@com.nanuri.rams.com.utils.MybatisCheck@empty(ardyBzepNo)">
            AND T2.ARDY_BZEP_NO     = #{ardyBzepNo}
           </if>
           <if test="@com.nanuri.rams.com.utils.MybatisCheck@empty(asstMngmAcno)">
            AND T2.ASST_MNGM_ACNO   = #{asstMngmAcno}
           </if>
           <if test="@com.nanuri.rams.com.utils.MybatisCheck@empty(dprtCd)">
            AND T2.DPRT_CD          = #{dprtCd}
           </if>
		  ORDER BY
		        T1.TR_DT
		      , T1.FINC_EXCU_RQS_SN
			  , T1.TR_SN
    </select>

</mapper>