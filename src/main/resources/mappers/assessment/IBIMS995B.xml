<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nanuri.rams.business.common.mapper.IBIMS995BMapper">

  <!-- 배치JOB MASTER 조회  -->
	<select id="selectIBIMS995B" parameterType="com.nanuri.rams.business.common.dto.IBIMS995BDTO" resultType="com.nanuri.rams.business.common.vo.IBIMS995BVO">
    SELECT JOB_ID                                  /* JOB ID */
         , JOB_NAME                                /* JOB NAME */
         , JOB_TYPE                                /* JOB TYPE */
         , OBJECT_NAME                             /* SOURCE FULL NAME */
         , ARGUMENT                                /* ARGUMENT */
         , NVL(CONFIRM_YN,'N') AS CONFIRM_YN    /* CONFIRM_YN */
         , DESCRIPTION                             /* 작업 설명 */
         , REGISTER_DAY                            /* 최초 등록일 */
         , NVL(LAST_UPDATE_DAY,REGISTER_DAY) AS LAST_UPDATE_DAY /* 최종 수정일 */
         , HND_DETL_DTM                            /* 조작상세일시 */
         , HND_EMPNO                               /* 조작사원번호 */
         , HND_TMNL_NO                             /* 조작단말기번호 */
         , HND_TR_ID                               /* 조작거래ID */
         , GUID                                    /* GUID */
         , CASE WHEN JOB_TYPE = '1' THEN 'Dummy' 
                WHEN JOB_TYPE = '2' THEN 'Command' 
                ELSE ''
            END AS JOB_TYPE_NAME                   /* JOB TYPE NAME*/
         , EXEC_FRQC								/* 실행주기 */
         , EXEC_TM									/* 실행시간 */
      FROM IBIMS995B
     WHERE 1=1
		   AND JOB_ID LIKE '%' || #{jobId} || '%'
		   AND JOB_NAME LIKE '%' || #{jobName} || '%'
  	</select>    

    <!-- 배치JOB MASTER 입력  -->
    <insert id="insertIBIMS995B" parameterType="com.nanuri.rams.business.common.dto.IBIMS995BDTO">
        INSERT INTO IBIMS995B
              (
                  JOB_ID                           /* JOB ID */
                , JOB_NAME                         /* JOB NAME */
                , JOB_TYPE                         /* JOB TYPE */
                , OBJECT_NAME                      /* SOURCE FULL NAME */
                , ARGUMENT                         /* ARGUMENT */
                , CONFIRM_YN                       /* CONFIRM_YN */
                , DESCRIPTION                      /* 작업 설명 */
                , REGISTER_DAY                     /* 최초 등록일 */
                , LAST_UPDATE_DAY                  /* 최종 수정일 */
                , HND_DETL_DTM                     /* 조작상세일시 */
                , HND_EMPNO                        /* 조작사원번호 */
                , HND_TMNL_NO                      /* 조작단말기번호 */
                , HND_TR_ID                        /* 조작거래ID */
                , GUID                             /* GUID */
              )
          SELECT
                  #{jobId}                         /* JOB ID */
                , #{jobName}                       /* JOB NAME */
                , #{jobType}                       /* JOB TYPE */
                , #{objectName}                    /* SOURCE FULL NAME */
                , #{argument}                      /* ARGUMENT */
                , #{confirmYn}                     /* CONFIRM_YN */
                , #{description}                   /* 작업 설명 */
                , #{registerDay}                   /* 최초 등록일 */
                , #{lastUpdateDay}                 /* 최종 수정일 */
                , SYSDATE                          /* 조작상세일시 */
                , #{hndEmpno}                      /* 조작사원번호 */
                , #{hndTmnlNo}                     /* 조작단말기번호 */
                , #{hndTrId}                       /* 조작거래ID */
                , #{guid}                          /* GUID */
    </insert>

    <!-- 배치JOB MASTER 수정  -->
    <update id="updateIBIMS995B" parameterType="com.nanuri.rams.business.common.dto.IBIMS995BDTO">
       UPDATE IBIMS995B
          SET JOB_ID          = #{jobId}                         /* JOB ID */
            , JOB_NAME        = #{jobName}                       /* JOB NAME */
            , JOB_TYPE        = #{jobType}                       /* JOB TYPE */
            , OBJECT_NAME     = #{objectName}                    /* SOURCE FULL NAME */
            , ARGUMENT        = #{argument}                      /* ARGUMENT */
            , CONFIRM_YN      = #{confirmYn}                     /* CONFIRM_YN */
            , DESCRIPTION     = #{description}                   /* 작업 설명 */
            , REGISTER_DAY    = (
                                 SELECT REGISTER_DAY 
                                   FROM IBIMS995B 
                                  WHERE JOB_ID = #{jobId}
                                )                                /* 최초 등록일 */
            , LAST_UPDATE_DAY = #{lastUpdateDay}                 /* 최종 수정일 */
            , HND_DETL_DTM    = SYSDATE                          /* 조작상세일시 */
            , HND_EMPNO       = #{hndEmpno}                      /* 조작사원번호 */
            , HND_TMNL_NO     = #{hndTmnlNo}                     /* 조작단말기번호 */
            , HND_TR_ID       = #{hndTrId}                       /* 조작거래ID */
            , GUID            = #{guid}                          /* GUID */
         WHERE 1=1
          AND JOB_ID          = #{jobId}
    </update>

    <!-- 배치JOB MASTER 삭제  -->
    <delete id="deleteIBIMS995B" parameterType="com.nanuri.rams.business.common.dto.IBIMS405BDTO">
        DELETE
          FROM IBIMS995B
         WHERE JOB_ID = #{jobId}
    </delete>
    
    <select id="selectBatchMaster" resultType="com.nanuri.rams.business.batch.job.entity.BatchMasterVo">
	SELECT JOB_ID        /* 작업 ID                      */
	     , JOB_NAME      /* 작업 이름                    */
	     , JOB_TYPE      /* 작업 유형 (1: DUMMY, 2: COMMAND) */
	     , OBJECT_NAME   /* 소스 전체 이름               */
	     , ARGUMENT      /* 프로그램에 전달될 인자       */
	     , CONFIRM_YN    /* 작업 승인 여부 ('N' 기본값)  */
	     , DESCRIPTION   /* 작업 설명                    */
	     , REGISTER_DAY  /* 최초 등록일                  */
	     , LAST_UPDATE_DAY /* 최종 수정일                */
	     , HND_DETL_DTM  /* 조작 상세 일시 (TIMESTAMP)   */
	     , HND_EMPNO     /* 조작 사원번호                */
	     , HND_TMNL_NO  /* 조작 단말기 번호             */
	     , HND_TR_ID     /* 조작 거래 ID                 */
	     , GUID          /* GUID (고유 식별자)           */
	     , EXEC_FRQC     /* 실행 빈도                    */
	     , EXEC_TM       /* 실행 시간                    */
	  FROM IBIMS995B;
  	</select>
  	
  	<select id="getBatchScheduleStatus" resultType="com.nanuri.rams.business.batch.job.entity.BatchMasterVo">
    	SELECT A.JOB_ID             /* 배치JOB MASTER의 JOB ID */
    	     , A.JOB_NAME
    	     , A.JOB_TYPE
    	     , A.OBJECT_NAME
    	     , A.ARGUMENT
		     , A.CONFIRM_YN         /* 배치JOB MASTER의 CONFIRM 작업 유무 */
		     , A.EXEC_TM            /* 배치JOB MASTER의 실행시간 */
		     , B.CUR_DATE           /* 배치JOB 스케줄러의 당일일자 */
		     , B.JOB_STATUS         /* 배치JOB 스케줄러의 작업 상태 */
		  FROM IBIMS995B A              /* 배치JOB MASTER 테이블 */
		  LEFT JOIN IBIMS997B B         /* 배치JOB 스케줄러 테이블 */
		    ON 1=1
		   AND A.JOB_ID = B.JOB_ID
		   AND B.CUR_DATE = #{date} /* 당일일자 */
		 WHERE 1=1
	</select>
  	
</mapper>