<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nanuri.rams.business.common.mapper.IBIMS901BMapper">

    <!-- 유동화증권 발행(예정)내역 -->
    <select id="pblHisList" parameterType="String" resultType="com.nanuri.rams.business.common.dto.IBIMS901BDTO">
        SELECT ARDY_BZEP_NO
             , LQDZ_SCTY_ISU_TMRD
             , ISU_DT
             , EXP_DT
             , ISU_AMT
             , HND_DETL_DTM
             , HND_EMPNO
          FROM IBIMS901B
         WHERE 1=1
           AND ARDY_BZEP_NO = #{ardyBzepNo}             /* SPC */
    </select>

    <!-- 삭제해야할 유동화증권 발행(예정)내역 -->
    <select id="deletedPblHisList" parameterType="com.nanuri.rams.business.common.dto.IBIMS901BDTO" resultType="com.nanuri.rams.business.common.dto.IBIMS901BDTO">
        SELECT ARDY_BZEP_NO
             , LQDZ_SCTY_ISU_TMRD
          FROM IBIMS901B
         WHERE 1=1
           AND ARDY_BZEP_NO IN (
            <foreach item="item" collection="list" separator=",">
              #{item.ardyBzepNo}
            </foreach>
           )
           AND LQDZ_SCTY_ISU_TMRD NOT IN (
            <foreach item="item" collection="list" separator=",">
              #{item.lqdzSctyIsuTmrd}
            </foreach>
           )
    </select>

    <!-- 유동화증권 발행내역 삭제 -->
    <delete id="deletePblHis" parameterType="com.nanuri.rams.business.common.dto.IBIMS901BDTO">
        DELETE IBIMS901B
         WHERE 1=1
           AND ARDY_BZEP_NO = #{ardyBzepNo}
           AND LQDZ_SCTY_ISU_TMRD = #{lqdzSctyIsuTmrd}
    </delete>

    

</mapper>